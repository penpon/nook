{"id":3551098374,"node_id":"PRR_kwDOPA1kFM7TqXYG","user":{"login":"coderabbitai[bot]","id":136622811,"node_id":"BOT_kgDOCCSy2w","avatar_url":"https://avatars.githubusercontent.com/in/347564?v=4","gravatar_id":"","url":"https://api.github.com/users/coderabbitai%5Bbot%5D","html_url":"https://github.com/apps/coderabbitai","followers_url":"https://api.github.com/users/coderabbitai%5Bbot%5D/followers","following_url":"https://api.github.com/users/coderabbitai%5Bbot%5D/following{/other_user}","gists_url":"https://api.github.com/users/coderabbitai%5Bbot%5D/gists{/gist_id}","starred_url":"https://api.github.com/users/coderabbitai%5Bbot%5D/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/coderabbitai%5Bbot%5D/subscriptions","organizations_url":"https://api.github.com/users/coderabbitai%5Bbot%5D/orgs","repos_url":"https://api.github.com/users/coderabbitai%5Bbot%5D/repos","events_url":"https://api.github.com/users/coderabbitai%5Bbot%5D/events{/privacy}","received_events_url":"https://api.github.com/users/coderabbitai%5Bbot%5D/received_events","type":"Bot","user_view_type":"public","site_admin":false},"body":"**Actionable comments posted: 0**\n\n<details>\n<summary>ğŸ§¹ Nitpick comments (1)</summary><blockquote>\n\n<details>\n<summary>tests/services/github_trending/test_github_trending.py (1)</summary><blockquote>\n\n`424-554`: **Strengthen error-path tests by asserting exception messages**\n\nThe error-case tests around `_render_markdown` (missing fields, invalid types, invalid language values) currently only assert the exception type. As per coding guidelines, error tests should also validate the message via `pytest.raises`. This will better pin down the contract and guard against regressions in error wording.\n\nExample pattern you could apply (and replicate across these tests):\n\n```diff\n-        with pytest.raises(KeyError):\n-            trending._render_markdown(records, today)\n+        with pytest.raises(KeyError, match=\"name\"):\n+            trending._render_markdown(records, today)\n```\n\nAdjust the `match=` string per the actual error messages raised in `GithubTrending._render_markdown`.\n\n</blockquote></details>\n\n</blockquote></details>\n\n<details>\n<summary>ğŸ“œ Review details</summary>\n\n**Configuration used**: Path: .coderabbit.yaml\n\n**Review profile**: CHILL\n\n**Plan**: Pro\n\n<details>\n<summary>ğŸ“¥ Commits</summary>\n\nReviewing files that changed from the base of the PR and between e58660a57a6d19cfb27df7a7ec2a37c1be7f8eaf and 7acbf47b63e5f11c4c8ed5db7f0b1c0009c15d85.\n\n</details>\n\n<details>\n<summary>ğŸ“’ Files selected for processing (6)</summary>\n\n* `tests/services/business_feed/__init__.py` (1 hunks)\n* `tests/services/business_feed/test_business_feed.py` (2 hunks)\n* `tests/services/github_trending/test_github_trending.py` (38 hunks)\n* `tests/services/github_trending/test_github_trending_collect.py` (1 hunks)\n* `tests/services/tech_feed/__init__.py` (1 hunks)\n* `tests/services/tech_feed/test_tech_feed.py` (1 hunks)\n\n</details>\n\n<details>\n<summary>âœ… Files skipped from review due to trivial changes (4)</summary>\n\n* tests/services/business_feed/__init__.py\n* tests/services/tech_feed/test_tech_feed.py\n* tests/services/business_feed/test_business_feed.py\n* tests/services/tech_feed/__init__.py\n\n</details>\n\n<details>\n<summary>ğŸš§ Files skipped from review as they are similar to previous changes (1)</summary>\n\n* tests/services/github_trending/test_github_trending_collect.py\n\n</details>\n\n<details>\n<summary>ğŸ§° Additional context used</summary>\n\n<details>\n<summary>ğŸ““ Path-based instructions (3)</summary>\n\n<details>\n<summary>**/*.{py,txt,json}</summary>\n\n\n**ğŸ“„ CodeRabbit inference engine (.github/copilot-instructions.md)**\n\n> Hardcoded credentials (RAPRAS_USERNAME, RAPRAS_PASSWORD, PROXY_PASSWORD, etc.) are strictly prohibited - use environment variables instead\n\nFiles:\n- `tests/services/github_trending/test_github_trending.py`\n\n</details>\n<details>\n<summary>**/*.py</summary>\n\n\n**ğŸ“„ CodeRabbit inference engine (.github/copilot-instructions.md)**\n\n> `**/*.py`: Do not log passwords or phone numbers in any log statements\n> Address all bandit High severity security warnings\n> Maintain module boundary compliance - do not reverse the Scraper â†’ Analyzer â†’ Storage dependency order\n> Use constructor dependency injection instead of directly instantiating external dependencies within class methods\n> Use absolute imports instead of relative imports (avoid `from .module import`)\n> Avoid wildcard imports (`from module import *`) - always use explicit imports\n> Format all code to comply with Black formatter standards (line length â‰¤ 100 characters)\n> Resolve all Ruff linter errors including unused imports, unused variables, and other code quality issues\n> Include complete type hints for all function parameters and return types\n> Include comprehensive Google-style docstrings for all functions and methods with Args, Returns, and Raises sections\n> Maintain minimum test coverage of 80% for all new code\n> Keep files to a maximum of 500 lines of code\n> Keep individual functions to a maximum of 50 lines of code\n> Limit nesting depth to a maximum of 3 levels\n> Limit classes to a maximum of 15 methods\n> Use PascalCase for all class names\n> Use snake_case for all function and variable names\n> Use UPPER_SNAKE_CASE for all constant names\n> Prefix private methods with underscore using `_snake_case` naming convention\n> Avoid exception swallowing - never use bare `except:` or `except: pass` statements\n> Use specific exception types instead of generic Exception class in except statements\n> Implement exponential backoff strategy when implementing retry logic\n> Use async/await pattern appropriately for asynchronous operations and Playwright browser operations\n> Use proper asyncio patterns - avoid inappropriate use of `asyncio.run()` in async contexts\n\nFiles:\n- `tests/services/github_trending/test_github_trending.py`\n\n---\n\n**âš™ï¸ CodeRabbit configuration file**\n\n> è¡Œã®é•·ã•ãŒ88æ–‡å­—ä»¥å†…ã§ã‚ã‚Œã°æŒ‡æ‘˜ã—ãªã„ã€‚ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¯Ruffã§88æ–‡å­—ã®è¡Œé•·åˆ¶é™ã‚’ä½¿ç”¨ã—ã¦ã„ã‚‹ã€‚\n\nFiles:\n- `tests/services/github_trending/test_github_trending.py`\n\n</details>\n<details>\n<summary>**/*test*.py</summary>\n\n\n**ğŸ“„ CodeRabbit inference engine (.github/copilot-instructions.md)**\n\n> `**/*test*.py`: Write sufficient tests for all new implementations - do not delete existing tests to maintain coverage\n> Follow test design matrix structure when creating test cases for new implementations\n> Ensure error case tests are at least as numerous as normal case tests (error cases â‰¥ normal cases)\n> Validate exception type and message using pytest.raises context manager in all error case tests\n\nFiles:\n- `tests/services/github_trending/test_github_trending.py`\n\n</details>\n\n</details>\n\n</details>\n\n<details>\n<summary>â° Context from checks skipped due to timeout of 90000ms. You can increase the timeout in your CodeRabbit configuration to a maximum of 15 minutes (900000ms). (1)</summary>\n\n* GitHub Check: Agent\n\n</details>\n\n<details>\n<summary>ğŸ”‡ Additional comments (5)</summary><blockquote>\n\n<details>\n<summary>tests/services/github_trending/test_github_trending.py (5)</summary><blockquote>\n\n`34-87`: **Repository dataclass tests are clear and well-structured**\n\nThe BDD-style inline comments in Japanese align well with the docstrings and make the testsâ€™ intent explicit without changing behavior. No issues here.\n\n---\n\n`92-289`: **Sort-key tests give solid coverage over stars/published_at edge cases**\n\nThe scenarios around missing/None stars, missing/invalid `published_at`, and ordering across multiple records are well covered. The new comments (`å‰æ` / `æ“ä½œ` / `ç¢ºèª`) make each phase obvious and donâ€™t affect logic.\n\n---\n\n`294-423`: **Positive-path markdown rendering tests look robust**\n\nThe tests cover single/multiple languages, the special â€œall languagesâ€ label, missing description, and empty input. The localized comments improve readability without altering semantics; assertions match the described behavior.\n\n---\n\n`559-655`: **Markdown parsing tests correctly mirror rendered format**\n\nThe fixtures for single/all-language and multi-repo markdown match the rendered structure (headers, separators, star formatting). Assertions on `name`, `link`, `description`, `stars`, and normalized `language` look appropriate. No changes needed.\n\n---\n\n`660-799`: **Serialization tests cover key variations (multi-language, date, None description)**\n\nTests for `_serialize_repositories` validate language assignment, ISO UTC `published_at`, empty inputs, and `description=None`. The updated comments simply clarify Given/When/Then and keep the suite easy to follow.\n\n</blockquote></details>\n\n</blockquote></details>\n\n</details>\n\n<!-- This is an auto-generated comment by CodeRabbit for review status -->","state":"COMMENTED","html_url":"https://github.com/penpon/nook/pull/40#pullrequestreview-3551098374","pull_request_url":"https://api.github.com/repos/penpon/nook/pulls/40","author_association":"NONE","_links":{"html":{"href":"https://github.com/penpon/nook/pull/40#pullrequestreview-3551098374"},"pull_request":{"href":"https://api.github.com/repos/penpon/nook/pulls/40"}},"submitted_at":"2025-12-08T09:43:55Z","commit_id":"7acbf47b63e5f11c4c8ed5db7f0b1c0009c15d85"}